service: canary-aws-ping

frameworkVersion: '3'

provider:
  name: aws
  runtime: nodejs20.x
  stage: ${opt:stage, 'dev'}
  region: ${opt:region, 'us-east-1'}
  
  environment:
    APP_VERSION: ${self:custom.version}
    SERVERLESS_STAGE: ${self:provider.stage}
    LOG_LEVEL: ${opt:log-level, 'info'}

  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - logs:CreateLogGroup
            - logs:CreateLogStream
            - logs:PutLogEvents
          Resource: '*'

custom:
  version: ${file(package.json):version}
  
  # LocalStack configuration
  localstack:
    stages:
      - local
    host: http://localhost
    edgePort: 4566
    autostart: false

functions:
  ping:
    handler: src/handlers/ping.handler
    description: 'Ping service with Node.js version response'
    timeout: 10
    memorySize: 128
    
    events:
      - http:
          path: ping
          method: get
          cors: true

plugins:
  - serverless-localstack